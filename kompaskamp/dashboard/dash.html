<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - Kompas Kampus</title>
    
    <!-- Dependencies -->
    <script src="https://unpkg.com/alpinejs" defer></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="css/dash.css">
    <script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>

    <style>
        
    </style>
</head>
<body x-data="{ sidebarOpen: false }">
<!-- Header -->
<header class="fixed w-full bg-white shadow-lg z-50">
    <div class="flex justify-between items-center px-6 py-3">
        <div class="flex items-center space-x-4">
            <button @click="sidebarOpen = !sidebarOpen" 
                    class="p-2 rounded-lg hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-gray-200">
                <div class="w-6 h-5 flex flex-col justify-between">
                    <span class="w-full h-0.5 bg-gray-600 rounded-full transition-all duration-200"
                          :class="{'rotate-45 translate-y-2': sidebarOpen}"></span>
                    <span class="w-full h-0.5 bg-gray-600 rounded-full transition-all duration-200"
                          :class="{'opacity-0': sidebarOpen}"></span>
                    <span class="w-full h-0.5 bg-gray-600 rounded-full transition-all duration-200"
                          :class="{'-rotate-45 -translate-y-2': sidebarOpen}"></span>
                </div>
            </button>
            <div class="flex items-center">
                <img src="logohet.jpg" alt="Logo" class="h-12 w-auto">
                <span class="ml-3 text-xl font-bold">
                    <span class="text-blue-600">Kompas</span>
                    <span style="color: #ffff00">Kampus</span>
                </span>
            </div>
        </div>
            <!-- Desktop Navigation -->
            <nav class="hidden md:flex items-center space-x-6">
                <a href="home.html" class="text-gray-700 hover:text-blue-600">Home</a>
                <a href="../about/about.html" class="text-gray-700 hover:text-blue-600">About Us</a>
                <a href="../news/news.html" class="text-gray-700 hover:text-blue-600">News</a>
            </nav>

            <!-- User Menu -->
            <div class="flex items-center space-x-4">
                <div class="relative" x-data="{ isOpen: false }">
                    <button @click="isOpen = !isOpen" 
                            class="flex items-center space-x-3 bg-white p-2 rounded-lg hover:bg-gray-50">
                        <img src="student1.jpg" alt="Profile" class="w-10 h-10 rounded-full border-2 border-blue-500">
                        <div class="hidden md:block text-left">
                            <p id="user-fullname" class="font-semibold text-gray-800"></p>
                            <p class="text-sm text-gray-500">Student</p>
                        </div>
                        <i class="fas fa-chevron-down text-gray-400"></i>
                    </button>
                    <!-- Changed dropdown implementation -->
                    <div x-show="isOpen" 
                         x-transition:enter="transition ease-out duration-200"
                         x-transition:enter-start="opacity-0 scale-95"
                         x-transition:enter-end="opacity-100 scale-100"
                         x-transition:leave="transition ease-in duration-75"
                         x-transition:leave-start="opacity-100 scale-100"
                         x-transition:leave-end="opacity-0 scale-95"
                         @click.away="isOpen = false"
                         class="absolute right-0 mt-2 w-64 bg-white rounded-xl shadow-lg border border-gray-100 py-2 z-50">
                        <div class="px-4 py-3 border-b border-gray-100">
                            <p id="dropdown-fullname" class="font-semibold text-gray-800"></p>
                            <p id="dropdown-email" class="text-sm text-gray-500"></p>
                        </div>
                        <a href="profile.html" class="flex items-center space-x-3 px-4 py-3 hover:bg-gray-50">
                            <i class="fas fa-user-circle text-gray-600"></i>
                            <span>My Profile</span>
                        </a>
                        
                        <a href="../dashboard/php/logout.php" class="flex items-center space-x-3 px-4 py-3 text-red-600 hover:bg-red-50">
                            <i class="fas fa-sign-out-alt"></i>
                            <span>Logout</span>
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Sidebar - Updated with overlay -->
    <div class="relative z-40 md:hidden" 
         x-show="sidebarOpen" 
         @click.away="sidebarOpen = false">
        <!-- Overlay -->
        <div class="fixed inset-0 bg-gray-600 bg-opacity-75" 
             x-show="sidebarOpen"
             x-transition:enter="transition-opacity ease-linear duration-300"
             x-transition:enter-start="opacity-0"
             x-transition:enter-end="opacity-100"
             x-transition:leave="transition-opacity ease-linear duration-300"
             x-transition:leave-start="opacity-100"
             x-transition:leave-end="opacity-0"></div>

        <!-- Sidebar -->
        <aside class="fixed inset-y-0 left-0 max-w-xs w-full bg-white shadow-lg transform transition duration-300 ease-in-out"
               :class="{'translate-x-0': sidebarOpen, '-translate-x-full': !sidebarOpen}">
            <!-- Existing sidebar content -->
            <nav class="p-4 space-y-2 mt-20">
                <a href="#" class="flex items-center space-x-3 p-3 rounded-xl transition-all duration-300"
                   :class="{'bg-gradient-to-r from-indigo-600 to-purple-600 text-white': true}">
                    <i class="fas fa-home"></i>
                    <span>Dashboard</span>
                </a>
                
                <!-- Updated menu items with additional features -->
                <a href="latsol.html" class="flex items-center space-x-3 p-3 rounded-lg hover:bg-gray-100">
                    <i class="fas fa-book"></i>
                    <span>Latihan Soal</span>
                </a>

                <a href="rekprodi.html" class="flex items-center justify-between p-3 rounded-lg hover:bg-gray-100">
                    <div class="flex items-center space-x-3">
                        <i class="fas fa-chart-pie"></i>
                        <span>Rekomendasi Prodi</span>
                    </div>
                </a>

                <a href="../expstud/explore.html" class="flex items-center justify-between p-3 rounded-lg hover:bg-gray-100">
                    <div class="flex items-center space-x-3">
                        <i class="fas fa-university"></i>
                        <span>Info Prodi</span>
                    </div>
                    <span class="bg-purple-100 text-purple-600 text-xs px-2 py-1 rounded-full">New</span>
                </a>
                
                <a href="infobeasiswa.html" class="flex items-center space-x-3 p-3 rounded-lg hover:bg-gray-100">
                    <i class="fas fa-graduation-cap"></i>
                    <span>Info Beasiswa</span>
                </a>
                <a href="feedback.html" class="flex items-center space-x-3 p-3 rounded-lg hover:bg-gray-100">
                    <i class="fas fa-comment"></i>
                    <span>Feedback</span>
                </a>
            </nav>
        </aside>
    </div>

    <!-- Desktop Sidebar -->
    <aside class="hidden md:block fixed left-0 top-0 h-full shadow-lg pt-20 bg-white" 
           :class="{'translate-x-0': sidebarOpen, '-translate-x-full': !sidebarOpen}">
        <!-- Existing sidebar content -->
        <nav class="p-4 space-y-2">
            <a href="#" class="flex items-center space-x-3 p-3 rounded-xl transition-all duration-300"
               :class="{'bg-gradient-to-r from-indigo-600 to-purple-600 text-white': true}">
                <i class="fas fa-home"></i>
                <span>Dashboard</span>
            </a>
            
            <!-- Updated menu items with additional features -->
            <a href="latsol.html" class="flex items-center space-x-3 p-3 rounded-lg hover:bg-gray-100">
                <i class="fas fa-book"></i>
                <span>Latihan Soal</span>
            </a>

            <a href="rekprodi.html" class="flex items-center justify-between p-3 rounded-lg hover:bg-gray-100">
                <div class="flex items-center space-x-3">
                    <i class="fas fa-chart-pie"></i>
                    <span>Rekomendasi Prodi</span>
                </div>
            </a>

            <a href="../expstud/explore.html" class="flex items-center justify-between p-3 rounded-lg hover:bg-gray-100">
                <div class="flex items-center space-x-3">
                    <i class="fas fa-university"></i>
                    <span>Info Prodi</span>
                </div>
                <span class="bg-purple-100 text-purple-600 text-xs px-2 py-1 rounded-full">New</span>
            </a>
            
            <a href="infobeasiswa.html" class="flex items-center space-x-3 p-3 rounded-lg hover:bg-gray-100">
                <i class="fas fa-graduation-cap"></i>
                <span>Info Beasiswa</span>
            </a>
            <a href="feedback.html" class="flex items-center space-x-3 p-3 rounded-lg hover:bg-gray-100">
                <i class="fas fa-comment"></i>
                <span>Feedback</span>
            </a>
        </nav>
    </aside>

    <main class="main-content pt-20 p-6">
        <!-- Welcome Section -->
        <div class="card-dashboard p-8 mb-8 rounded-2xl animate-fade-in">
            <div class="flex justify-between items-center">
                <div>
                    <h1 id="welcome-message" class="text-3xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-indigo-600 to-purple-600">
                        Selamat datang, John Doe!
                    </h1>
                    <p class="text-gray-600 mt-2">Mari temukan jurusan yang sesuai dengan potensi akademik dan nilai keislamanmu</p>
                </div>
                <div class="hidden md:block">
                </div>
            </div>
        </div>

        <!-- Quick Actions Grid - adjust spacing -->
        <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
            <!-- Quick Assessment Button -->
            <a href="assessment.html" class="group bg-white rounded-xl p-6 shadow-sm hover:shadow-lg transition-all">
                <div class="flex items-center justify-between">
                    <div class="flex items-center space-x-4">
                        <div class="p-3 bg-indigo-100 rounded-full group-hover:bg-indigo-200 transition-colors">
                            <i class="fas fa-brain text-indigo-600 text-xl"></i>
                        </div>
                        <div>
                            <h3 class="font-semibold text-gray-800">Mulai Assessment</h3>
                            <p class="text-sm text-gray-600">Cari tahu potensimu</p>
                        </div>
                    </div>
                    <i class="fas fa-arrow-right text-indigo-600 group-hover:translate-x-1 transition-transform"></i>
                </div>
            </a>

            <!-- Practice Tests -->
            <a href="latsol.html" class="group bg-white rounded-xl p-6 shadow-sm hover:shadow-lg transition-all">
                <div class="flex items-center justify-between">
                    <div class="flex items-center space-x-4">
                        <div class="p-3 bg-green-100 rounded-full group-hover:bg-green-200 transition-colors">
                            <i class="fas fa-book text-green-600 text-xl"></i>
                        </div>
                        <div>
                            <h3 class="font-semibold text-gray-800">Latihan Soal</h3>
                            <p class="text-sm text-gray-600">24 soal tersedia</p>
                        </div>
                    </div>
                    <i class="fas fa-arrow-right text-green-600 group-hover:translate-x-1 transition-transform"></i>
                </div>
            </a>

            <!-- Program Info -->
            <a href="../expstud/explore.html" class="group bg-white rounded-xl p-6 shadow-sm hover:shadow-lg transition-all">
                <div class="flex items-center justify-between">
                    <div class="flex items-center space-x-4">
                        <div class="p-3 bg-purple-100 rounded-full group-hover:bg-purple-200 transition-colors">
                            <i class="fas fa-university text-purple-600 text-xl"></i>
                        </div>
                        <div>
                            <h3 class="font-semibold text-gray-800">Info Program Studi</h3>
                            <p class="text-sm text-gray-600">Explore 50+ program</p>
                        </div>
                    </div>
                    <i class="fas fa-arrow-right text-purple-600 group-hover:translate-x-1 transition-transform"></i>
                </div>
            </a>
        </div>

        <!-- Stats Grid - adjust spacing -->
        <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
            <!-- UPCM Readiness -->
            <div class="card-dashboard p-6">
                <div class="flex flex-col items-center text-center">
                    <div class="p-3 bg-blue-100 rounded-full mb-3">
                        <i class="fas fa-chart-line text-blue-600 text-xl"></i>
                    </div>
                    <h3 class="text-lg font-semibold text-gray-700">Kesiapan UPCM</h3>
                    <span id="upcm-readiness" class="text-3xl font-bold text-blue-600 mt-2">0%</span>
                    <p class="text-sm text-gray-600 mt-1">Berdasarkan Latihan Soal</p>
                </div>
            </div>

            <!-- Learning Progress -->
            <div class="card-dashboard p-6">
                <div class="flex flex-col items-center text-center">
                    <div class="p-3 bg-purple-100 rounded-full mb-3">
                        <i class="fas fa-book-reader text-purple-600 text-xl"></i>
                    </div>
                    <h3 class="text-lg font-semibold text-gray-700">Progress Belajar</h3>
                    <span id="learning-progress" class="text-3xl font-bold text-purple-600 mt-2">0%</span>
                    <script>
                        document.addEventListener('DOMContentLoaded', () => {
                            const progressElement = document.getElementById('learning-progress');
                            const progressValue = parseInt(progressElement.textContent);

                            if (progressValue < 50) {
                                progressElement.classList.remove('text-purple-600');
                                progressElement.classList.add('text-red-600');
                            }
                        });
                    </script>
                    <p class="text-sm text-gray-600 mt-1">Materi Selesai</p>
                </div>
            </div>

            <!-- Total Tests -->
            <div class="card-dashboard p-6">
                <div class="flex flex-col items-center text-center">
                    <div class="p-3 bg-green-100 rounded-full mb-3">
                        <i class="fas fa-check-circle text-green-600 text-xl"></i>
                    </div>
                    <h3 class="text-lg font-semibold text-gray-700">Total Tests</h3>
                    <span id="total-tests" class="text-3xl font-bold text-green-600 mt-2">0</span>
                    <script>
                        document.addEventListener('DOMContentLoaded', () => {
                            const totalTestsElement = document.getElementById('total-tests');
                            const totalTestsValue = parseInt(totalTestsElement.textContent);

                            if (totalTestsValue < 4) {
                                totalTestsElement.classList.remove('text-green-600');
                                totalTestsElement.classList.add('text-red-600');
                            }
                        });
                    </script>
                    <p class="text-sm text-gray-600 mt-1">Completed Tests</p>
                </div>
            </div>
        </div>

        <!-- Two Column Layout - adjust spacing -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
            <!-- Left Column -->
            <div class="content-wrapper">
                <!-- Program Match Analysis -->
                <div class="card-dashboard p-6">
                    <div class="flex items-center space-x-3 mb-6">
                        <div class="p-2 bg-green-100 rounded-full">
                            <i class="fas fa-bullseye text-green-600"></i>
                        </div>
                        <h3 class="text-lg font-semibold text-gray-700">Analisis Kecocokan Program</h3>
                    </div>
                    
                    <div id="programMatchChart" class="mb-6"></div>

                    <div id="whyProgramSection" class="bg-gray-50 p-4 rounded-lg" style="display: none;">
                        <h4 class="font-medium text-gray-800 mb-3" id="whyProgram">Mengapa Program Ini?</h4>
                        <ul class="space-y-3">
                            <li class="flex items-center space-x-3">
                                <i class="fas fa-check-circle text-green-500"></i>
                                <span class="text-sm">Kemampuan analitis yang kuat </span>
                            </li>
                            <li class="flex items-center space-x-3">
                                <i class="fas fa-check-circle text-green-500"></i>
                                <span class="text-sm">Logika yang cukup baik</span>
                            </li>
                        </ul>
                    </div>
                </div>

                <!-- Interest Distribution -->
                <div class="card-dashboard p-6">
                    <div class="flex items-center space-x-3 mb-6">
                        <div class="p-2 bg-purple-100 rounded-full">
                            <i class="fas fa-chart-pie text-purple-600"></i>
                        </div>
                        <h3 class="text-lg font-semibold text-gray-700">Distribusi Minat</h3>
                    </div>

                    <div id="interestChart" class="mb-6"></div>

                    <div class="bg-gray-50 p-4 rounded-lg">
                        <h4 class="font-medium text-gray-800 mb-3">Prospek Karir</h4>
                        <div id="careerProspectsList" class="grid grid-cols-2 gap-3">
                            <!-- Career prospects will be populated here -->
                        </div>
                    </div>
                </div>
            </div>

            <!-- Right Column -->
            <div class="content-wrapper">
                <!-- AI Analysis Card -->
                <div class="card-dashboard p-6">
                    <div class="flex items-center justify-between mb-6">
                        <div class="flex items-center space-x-3">
                            <div class="p-3 bg-indigo-100 rounded-xl">
                                <i class="fas fa-robot text-indigo-600 text-xl"></i>
                            </div>
                            <div>
                                <h3 class="text-xl font-bold text-gray-800">AI Analysis</h3>
                                <p class="text-gray-600">Based on your recent assessment</p>
                            </div>
                        </div>
                        <span class="px-3 py-1 bg-green-100 text-green-600 rounded-full text-sm font-medium">
                            95% Match
                        </span>
                    </div>
                    <!-- AI Analysis Content -->
                    <div class="bg-gradient-to-r from-indigo-50 to-purple-50 rounded-xl p-6">
                        <!-- Top Row -->
                        <div id="profile-section" class="flex justify-between mb-6" style="display: none;">
                            <div>
                                <h4 class="font-semibold text-gray-800 mb-2">Your Profile: The Analyst</h4>
                                <div class="flex flex-wrap gap-2">
                                    <span class="px-2 py-1 bg-white rounded-full text-sm text-gray-600">Logis</span>
                                    <span class="px-2 py-1 bg-white rounded-full text-sm text-gray-600">Analitis</span>
                                    <span class="px-2 py-1 bg-white rounded-full text-sm text-gray-600">Sistematis</span>
                                </div>
                            </div>
                            <div>
                                <h4 class="font-semibold text-gray-800 mb-2">Key Skills</h4>
                                <div class="text-sm text-gray-600">
                                    <div class="flex items-center gap-2">
                                        <i class="fas fa-star text-yellow-400"></i>
                                        Technical Analysis
                                    </div>
                                    <div class="flex items-center gap-2">
                                        <i class="fas fa-star text-yellow-400"></i>
                                        Problem Solving
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Bottom Row - Skill Bars -->
                        <div id="skill-bars-section" class="space-y-4" style="display: none;">
                            <div>
                                <div class="flex justify-between mb-1">
                                    <span class="text-sm text-gray-600">Technical Skills</span>
                                    <span class="text-sm font-medium text-indigo-600">92%</span>
                                </div>
                                <div class="h-2 bg-gray-200 rounded-full">
                                    <div class="h-2 bg-indigo-600 rounded-full" style="width: 92%"></div>
                                </div>
                            </div>
                            <div>
                                <div class="flex justify-between mb-1">
                                    <span class="text-sm text-gray-600">Analytical Thinking</span>
                                    <span class="text-sm font-medium text-indigo-600">88%</span>
                                </div>
                                <div class="h-2 bg-gray-200 rounded-full">
                                    <div class="h-2 bg-indigo-600 rounded-full" style="width: 88%"></div>
                                </div>
                            </div>
                            <div>
                                <div class="flex justify-between mb-1">
                                    <span class="text-sm text-gray-600">Problem Solving</span>
                                    <span class="text-sm font-medium text-indigo-600">85%</span>
                                </div>
                                <div class="h-2 bg-gray-200 rounded-full">
                                    <div class="h-2 bg-indigo-600 rounded-full" style="width: 85%"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Performance Analysis -->
                <div class="card-dashboard p-6">
                    <h3 class="text-xl font-semibold text-gray-800 mb-4">Study Statistics</h3>
                    <div class="space-y-4" id="study-stats">
                        <div>
                            <div class="flex justify-between mb-1">
                                <span class="text-sm">Matematika</span>
                                <span class="text-sm font-medium" id="mtk-score">0%</span>
                            </div>
                            <div class="w-full bg-gray-200 rounded-full h-2">
                                <div id="mtk-bar" class="bg-blue-600 h-2 rounded-full" style="width: 0%"></div>
                            </div>
                        </div>
                        <div>
                            <div class="flex justify-between mb-1">
                                <span class="text-sm">Pendidikan Agama Islam</span>
                                <span class="text-sm font-medium" id="pai-score">0%</span>
                            </div>
                            <div class="w-full bg-gray-200 rounded-full h-2">
                                <div id="pai-bar" class="bg-purple-600 h-2 rounded-full" style="width: 0%"></div>
                            </div>
                        </div>
                        <div>
                            <div class="flex justify-between mb-1">
                                <span class="text-sm">Bahasa Inggris</span>
                                <span class="text-sm font-medium" id="inggris-score">0%</span>
                            </div>
                            <div class="w-full bg-gray-200 rounded-full h-2">
                                <div id="inggris-bar" class="bg-green-600 h-2 rounded-full" style="width: 0%"></div>
                            </div>
                        </div>
                        <div>
                            <div class="flex justify-between mb-1">
                                <span class="text-sm">Logika dan Penalaran Analitik</span>
                                <span class="text-sm font-medium" id="logika-score">0%</span>
                            </div>
                            <div class="w-full bg-gray-200 rounded-full h-2">
                                <div id="logika-bar" class="bg-yellow-600 h-2 rounded-full" style="width: 0%"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    
    </main>

    <script>
        const careers = {
            // Realistic combinations (20 total)
            'RIA': ['Insinyur Penelitian & Pengembangan', 'Arsitek Teknikal', 'Teknisi Laboratorium', 'Desainer Produk Industrial'],
            'RIE': ['Insinyur Software', 'Data Scientist', 'Manajer Proyek IT', 'Konsultan Teknologi'],
            'RIC': ['Analis Sistem Teknis', 'Peneliti Keamanan Cyber', 'Spesialis Quality Control', 'Teknisi Sistem'],
            'RIS': ['Teknisi Medis', 'Insinyur Biomedis', 'Peneliti Lingkungan', 'Spesialis Keselamatan Kerja'],
            'RAI': ['Desainer Robotik', 'Teknisi Otomasi', 'Pengembang Prototipe', 'Insinyur Mekatronika'],
            'RAE': ['Desainer Produk', 'Kontraktor Independen', 'Pengembang Real Estate', 'Arsitek Lansekap'],
            'RAC': ['Teknisi Seni Digital', 'Spesialis CAD', 'Desainer Teknis', 'Teknisi Pencetakan 3D'],
            'RAS': ['Terapis Fisik', 'Instruktur Teknis', 'Spesialis Rehabilitasi', 'Teknisi Medis Senior'],
            'REI': ['Manajer Teknis', 'Direktur Operasional', 'Supervisor Produksi', 'Koordinator Proyek Teknis'],
            'REA': ['Manajer Proyek Konstruksi', 'Direktur Fasilitas', 'Pengembang Property', 'Supervisor Manufaktur'],
            'REC': ['Manajer Operasi', 'Supervisor Logistik', 'Koordinator Pemeliharaan', 'Manajer Proyek Teknis'],
            'RES': ['Koordinator Keselamatan', 'Supervisor Tim Teknis', 'Manajer Fasilitas Medis', 'Koordinator Pelatihan Teknis'],
            'RCI': ['Analis Kontrol Kualitas', 'Spesialis Kepatuhan Teknis', 'Inspektor Teknis', 'Auditor Sistem'],
            'RCA': ['Teknisi Seni Industri', 'Spesialis Desain Teknis', 'Koordinator Produksi Kreatif', 'Teknisi Multimedia'],
            'RCE': ['Manajer Kontrol Kualitas', 'Supervisor Pemeliharaan', 'Koordinator Operasional', 'Manajer Fasilitas'],
            'RCS': ['Teknisi Keselamatan', 'Koordinator Pemeliharaan Medis', 'Spesialis Kepatuhan K3', 'Inspektor Kesehatan'],
            'RSI': ['Peneliti Kesehatan Kerja', 'Spesialis Ergonomi', 'Teknisi Laboratorium Medis', 'Konsultan Keselamatan'],
            'RSA': ['Instruktur Teknis Kesehatan', 'Terapis Okupasional', 'Pelatih Rehabilitasi', 'Spesialis Alat Bantu'],
            'RSE': ['Manajer Keselamatan', 'Supervisor Kesehatan', 'Koordinator Teknis Medis', 'Direktur Fasilitas Medis'],
            'RSC': ['Koordinator Kepatuhan K3', 'Spesialis Prosedur Teknis', 'Pengawas Keselamatan', 'Auditor Kesehatan'],

            // Investigative combinations (20 total)
            'IRA': ['Peneliti Pengembangan Produk', 'Ilmuwan Material', 'Peneliti Teknologi', 'Insinyur R&D'],
            'IRE': ['Peneliti Sistem', 'Ilmuwan Data', 'Manajer Riset Teknologi', 'Konsultan Teknis'],
            'IRC': ['Analis Sistem', 'Peneliti Keamanan', 'Spesialis Quality Assurance', 'Pengembang Protokol'],
            'IRS': ['Peneliti Medis', 'Ilmuwan Biomedis', 'Analis Kesehatan', 'Peneliti Ergonomi'],
            'IAR': ['Peneliti Desain', 'Ilmuwan Kreatif', 'Pengembang Media Interaktif', 'Peneliti UX'],
            'IAE': ['Peneliti Inovasi', 'Konsultan Desain', 'Pengembang Produk Kreatif', 'Direktur R&D'],
            'IAC': ['Peneliti UX/UI', 'Analis Desain Sistem', 'Spesialis Informasi Visual', 'Peneliti Media Digital'],
            'IAS': ['Peneliti Pendidikan', 'Pengembang Kurikulum', 'Konsultan Pembelajaran', 'Peneliti Psikologi Pendidikan'],
            'IER': ['Manajer Penelitian', 'Direktur Inovasi Teknis', 'Konsultan Teknologi Senior', 'Kepala Pengembangan'],
            'IEA': ['Direktur Pengembangan Produk', 'Manajer Inovasi Kreatif', 'Konsultan Strategi', 'Kepala R&D'],
            'IEC': ['Direktur Sistem Informasi', 'Manajer Proyek Teknologi', 'Konsultan IT Senior', 'Kepala Teknologi'],
            'IES': ['Direktur Pengembangan SDM', 'Konsultan Organisasi', 'Manajer Pelatihan Senior', 'Kepala Program'],
            'ICR': ['Analis Sistem Senior', 'Peneliti Keamanan IT', 'Spesialis Quality Control', 'Auditor Teknis'],
            'ICA': ['Arsitek Sistem Senior', 'Analis Desain', 'Peneliti UX Senior', 'Spesialis Dokumentasi Teknis'],
            'ICE': ['Manajer Sistem Senior', 'Direktur Operasi IT', 'Konsultan Sistem', 'Kepala Infrastruktur'],
            'ICS': ['Analis Kebijakan Senior', 'Peneliti Sistem Sosial', 'Koordinator Program Senior', 'Spesialis Compliance'],
            'ISR': ['Peneliti Kesehatan', 'Ilmuwan Sosial', 'Peneliti Keselamatan Kerja', 'Konsultan Ergonomi'],
            'ISA': ['Peneliti Psikologi', 'Konsultan Pendidikan', 'Peneliti Seni Terapi', 'Pengembang Program Sosial'],
            'ISE': ['Direktur Program Sosial', 'Manajer Penelitian Sosial', 'Konsultan Pengembangan', 'Kepala Program Komunitas'],
            'ISC': ['Analis Kebijakan Sosial', 'Peneliti Program', 'Koordinator Evaluasi', 'Spesialis Manajemen Data'],

            // Artistic combinations (20 total) 
            'AIR': ['Desainer UX/UI', 'Arsitek Digital', 'Seniman Teknis', 'Animator 3D'],
            'AIS': ['Terapis Seni', 'Desainer Pembelajaran', 'Konselor Kreatif', 'Pengembang Media Edukasi'],
            'AIE': ['Direktur Kreatif', 'Manajer Inovasi', 'Konsultan Desain', 'Pengembang Produk Kreatif'],
            'AIC': ['Desainer Sistem', 'Arsitek Informasi', 'Spesialis UX Research', 'Analis Desain'],
            'ARI': ['Desainer Produk', 'Arsitek', 'Seniman Digital', 'Pengembang Multimedia'],
            'ARE': ['Direktur Seni', 'Manajer Desain', 'Pengembang Kreatif', 'Supervisor Produksi Seni'],
            'ARC': ['Desainer Teknis', 'Ilustrator Teknis', 'Spesialis CAD', 'Koordinator Produksi Seni'],
            'ARS': ['Terapis Okupasional Kreatif', 'Instruktur Seni', 'Fasilitator Workshop', 'Koordinator Program Seni'],
            'AEI': ['Direktur Kreatif', 'Produser Eksekutif', 'Manajer Konten', 'Konsultan Media'],
            'AER': ['Manajer Produksi Kreatif', 'Direktur Artistik', 'Supervisor Desain', 'Koordinator Proyek Seni'],
            'AEC': ['Manajer Konten Digital', 'Produser Media', 'Koordinator Produksi', 'Direktur Program Kreatif'],
            'AES': ['Direktur Program Seni', 'Manajer Event Kreatif', 'Koordinator Workshop', 'Konsultan Program Budaya'],
            'ACI': ['Desainer UX Senior', 'Arsitek Informasi', 'Analis Media', 'Spesialis Dokumentasi Kreatif'],
            'ACR': ['Desainer Teknis Senior', 'Koordinator Produksi', 'Spesialis Media Teknis', 'Ilustrator Teknis Senior'],
            'ACE': ['Manajer Produksi Digital', 'Direktur Konten', 'Koordinator Media', 'Supervisor Proyek Kreatif'],
            'ACS': ['Koordinator Program Seni', 'Spesialis Media Edukasi', 'Fasilitator Kreatif', 'Administrator Program'],
            'ASI': ['Terapis Seni', 'Konselor Kreatif', 'Pengajar Seni', 'Spesialis Program Kreatif'],
            'ASR': ['Instruktur Seni Teknis', 'Terapis Okupasional', 'Koordinator Workshop', 'Fasilitator Program'],
            'ASE': ['Direktur Program Seni', 'Manajer Event Kreatif', 'Koordinator Program Budaya', 'Konsultan Pengembangan'],
            'ASC': ['Koordinator Program Kreatif', 'Administrator Seni', 'Spesialis Program', 'Fasilitator Workshop'],

            // Social combinations (20 total)
            'SIR': ['Peneliti Kesehatan', 'Ilmuwan Sosial', 'Peneliti Keselamatan Kerja', 'Konsultan Ergonomi'],
            'SIA': ['Peneliti Psikologi', 'Konsultan Pendidikan', 'Peneliti Seni Terapi', 'Pengembang Program Sosial'],
            'SIE': ['Direktur Program Sosial', 'Manajer Penelitian Sosial', 'Konsultan Pengembangan', 'Kepala Program Komunitas'],
            'SIC': ['Analis Kebijakan Sosial', 'Peneliti Program', 'Koordinator Evaluasi', 'Spesialis Manajemen Data'],
            'SRI': ['Instruktur Seni Teknis', 'Terapis Okupasional', 'Koordinator Workshop', 'Fasilitator Program'],
            'SRE': ['Direktur Program Seni', 'Manajer Event Kreatif', 'Koordinator Program Budaya', 'Konsultan Pengembangan'],
            'SRC': ['Koordinator Program Seni', 'Spesialis Media Edukasi', 'Fasilitator Kreatif', 'Administrator Program'],
            'SRA': ['Desainer UX Senior', 'Arsitek Informasi', 'Analis Media', 'Spesialis Dokumentasi Kreatif'],
            'SEI': ['Manajer Produksi Digital', 'Direktur Konten', 'Koordinator Media', 'Supervisor Proyek Kreatif'],
            'SER': ['Peneliti Kesehatan', 'Ilmuwan Sosial', 'Peneliti Keselamatan Kerja', 'Konsultan Ergonomi'],
            'SEC': ['Peneliti Psikologi', 'Konsultan Pendidikan', 'Peneliti Seni Terapi', 'Pengembang Program Sosial'],
            'SEA': ['Direktur Program Sosial', 'Manajer Penelitian Sosial', 'Konsultan Pengembangan', 'Kepala Program Komunitas'],
            'SCI': ['Analis Kebijakan Sosial', 'Peneliti Program', 'Koordinator Evaluasi', 'Spesialis Manajemen Data'],
            'SCR': ['Instruktur Seni Teknis', 'Terapis Okupasional', 'Koordinator Workshop', 'Fasilitator Program'],
            'SCE': ['Direktur Program Seni', 'Manajer Event Kreatif', 'Koordinator Program Budaya', 'Konsultan Pengembangan'],
            'SCA': ['Koordinator Program Seni', 'Spesialis Media Edukasi', 'Fasilitator Kreatif', 'Administrator Program'],
            'SAI': ['Desainer UX Senior', 'Arsitek Informasi', 'Analis Media', 'Spesialis Dokumentasi Kreatif'],
            'SAR': ['Manajer Produksi Digital', 'Direktur Konten', 'Koordinator Media', 'Supervisor Proyek Kreatif'],
            'SAE': ['Peneliti Kesehatan', 'Ilmuwan Sosial', 'Peneliti Keselamatan Kerja', 'Konsultan Ergonomi'],
            'SAC': ['Peneliti Psikologi', 'Konsultan Pendidikan', 'Peneliti Seni Terapi', 'Pengembang Program Sosial'],

            // Enterprising combinations (20 total)
            'EIR': ['Manajer Proyek IT', 'Konsultan Teknologi', 'Direktur Operasional', 'Supervisor Produksi'],
            'EIA': ['Manajer Inovasi', 'Konsultan Desain', 'Direktur Kreatif', 'Pengembang Produk Kreatif'],
            'EIC': ['Manajer Sistem', 'Konsultan IT', 'Direktur Operasi', 'Supervisor Infrastruktur'],
            'EIS': ['Manajer Pelatihan', 'Konsultan Organisasi', 'Direktur Pengembangan SDM', 'Kepala Program'],
            'ERI': ['Manajer Proyek Konstruksi', 'Direktur Fasilitas', 'Pengembang Real Estate', 'Supervisor Manufaktur'],
            'ERA': ['Manajer Inovasi', 'Konsultan Desain', 'Direktur Kreatif', 'Pengembang Produk Kreatif'],
            'ERC': ['Manajer Konten Digital', 'Produser Media', 'Koordinator Produksi', 'Direktur Program Kreatif'],
            'ERS': ['Direktur Program Seni', 'Manajer Event Kreatif', 'Koordinator Workshop', 'Konsultan Program Budaya'],
            'EAI': ['Manajer Produksi Digital', 'Direktur Konten', 'Koordinator Media', 'Supervisor Proyek Kreatif'],
            'EAR': ['Peneliti Kesehatan', 'Ilmuwan Sosial', 'Peneliti Keselamatan Kerja', 'Konsultan Ergonomi'],
            'EAC': ['Peneliti Psikologi', 'Konsultan Pendidikan', 'Peneliti Seni Terapi', 'Pengembang Program Sosial'],
            'EAS': ['Direktur Program Sosial', 'Manajer Penelitian Sosial', 'Konsultan Pengembangan', 'Kepala Program Komunitas'],
            'ECI': ['Analis Kebijakan Sosial', 'Peneliti Program', 'Koordinator Evaluasi', 'Spesialis Manajemen Data'],
            'ECR': ['Instruktur Seni Teknis', 'Terapis Okupasional', 'Koordinator Workshop', 'Fasilitator Program'],
            'ECA': ['Direktur Program Seni', 'Manajer Event Kreatif', 'Koordinator Program Budaya', 'Konsultan Pengembangan'],
            'ECS': ['Koordinator Program Seni', 'Spesialis Media Edukasi', 'Fasilitator Kreatif', 'Administrator Program'],
            'ESI': ['Desainer UX Senior', 'Arsitek Informasi', 'Analis Media', 'Spesialis Dokumentasi Kreatif'],
            'ESR': ['Manajer Produksi Digital', 'Direktur Konten', 'Koordinator Media', 'Supervisor Proyek Kreatif'],
            'ESA': ['Peneliti Kesehatan', 'Ilmuwan Sosial', 'Peneliti Keselamatan Kerja', 'Konsultan Ergonomi'],
            'ESC': ['Peneliti Psikologi', 'Konsultan Pendidikan', 'Peneliti Seni Terapi', 'Pengembang Program Sosial'],

            // Conventional combinations (20 total)
            'CIR': ['Analis Data Senior', 'Auditor Sistem', 'Spesialis Compliance', 'Manajer Quality Control'],
            'CIA': ['Analis Sistem Kreatif', 'Dokumentasi Teknis Senior', 'Spesialis UX Research', 'Arsitek Informasi'],
            'CIE': ['Manajer Operasi IT', 'Direktur Sistem', 'Kepala Departemen Teknis', 'Konsultan Teknologi'],
            'CIS': ['Manajer Proyek IT', 'Konsultan Teknologi', 'Direktur Operasional', 'Supervisor Produksi'],
            'CRI': ['Manajer Inovasi', 'Konsultan Desain', 'Direktur Kreatif', 'Pengembang Produk Kreatif'],
            'CRA': ['Manajer Sistem', 'Konsultan IT', 'Direktur Operasi', 'Supervisor Infrastruktur'],
            'CRE': ['Manajer Pelatihan', 'Konsultan Organisasi', 'Direktur Pengembangan SDM', 'Kepala Program'],
            'CRS': ['Manajer Proyek Konstruksi', 'Direktur Fasilitas', 'Pengembang Real Estate', 'Supervisor Manufaktur'],
            'CAI': ['Manajer Inovasi', 'Konsultan Desain', 'Direktur Kreatif', 'Pengembang Produk Kreatif'],
            'CAR': ['Manajer Konten Digital', 'Produser Media', 'Koordinator Produksi', 'Direktur Program Kreatif'],
            'CAE': ['Direktur Program Seni', 'Manajer Event Kreatif', 'Koordinator Workshop', 'Konsultan Program Budaya'],
            'CAS': ['Manajer Produksi Digital', 'Direktur Konten', 'Koordinator Media', 'Supervisor Proyek Kreatif'],
            'CEI': ['Peneliti Kesehatan', 'Ilmuwan Sosial', 'Peneliti Keselamatan Kerja', 'Konsultan Ergonomi'],
            'CER': ['Peneliti Psikologi', 'Konsultan Pendidikan', 'Peneliti Seni Terapi', 'Pengembang Program Sosial'],
            'CEA': ['Direktur Program Sosial', 'Manajer Penelitian Sosial', 'Konsultan Pengembangan', 'Kepala Program Komunitas'],
            'CES': ['Analis Kebijakan Sosial', 'Peneliti Program', 'Koordinator Evaluasi', 'Spesialis Manajemen Data'],
            'CSI': ['Instruktur Seni Teknis', 'Terapis Okupasional', 'Koordinator Workshop', 'Fasilitator Program'],
            'CSR': ['Direktur Program Seni', 'Manajer Event Kreatif', 'Koordinator Program Budaya', 'Konsultan Pengembangan'],
            'CSA': ['Koordinator Program Seni', 'Spesialis Media Edukasi', 'Fasilitator Kreatif', 'Administrator Program'],
            'CSE': ['Desainer UX Senior', 'Arsitek Informasi', 'Analis Media', 'Spesialis Dokumentasi Kreatif']
        };

        // Add these new functions before DOMContentLoaded
        const getCareersByType = (personalityType) => {
            return careers[personalityType] || [];
        };

        const getInterestDistribution = (personalityType) => {
            if (!personalityType || personalityType.length !== 3) return null;
            
            // Calculate percentages based on position
            // First letter has highest weight (50%), second (30%), third (20%)
            const distribution = {
                R: 0, I: 0, A: 0, S: 0, E: 0, C: 0
            };

            distribution[personalityType[0]] = 50;
            distribution[personalityType[1]] = 30;
            distribution[personalityType[2]] = 20;

            return distribution;
        };

        document.addEventListener('DOMContentLoaded', () => {
            const fullname = sessionStorage.getItem('fullname');
            const email = sessionStorage.getItem('email');

            if (fullname && email) {
                document.getElementById('user-fullname').textContent = fullname;
                document.getElementById('dropdown-fullname').textContent = fullname;
                document.getElementById('dropdown-email').textContent = email;
                document.getElementById('welcome-message').textContent = `Selamat datang, ${fullname}!`;
            }

            // Mengambil poin UPCM dari database melalui oauth.php
            const fetchUPCMPoints = async () => {
                try {
                    const response = await fetch('php/oauth.php?action=get_points');
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    const data = await response.json();
                    console.log('Data received:', data); // Tambah log untuk debugging
                    
                    const upcmElement = document.getElementById('upcm-readiness');
                    
                    if (data.status === 'success' && data.points !== null) {
                        // Update nilai dan warna
                        upcmElement.textContent = `${data.points}%`;
                        
                        // Hapus warna sebelumnya
                        upcmElement.classList.remove('text-blue-600', 'text-green-600', 'text-yellow-600', 'text-red-600');
                        
                        // Set warna berdasarkan nilai
                        if (data.points >= 80) {
                            upcmElement.classList.add('text-green-600');
                        } else if (data.points >= 60) {
                            upcmElement.classList.add('text-yellow-600');
                        } else {
                            upcmElement.classList.add('text-red-600');
                        }
                    } else {
                        console.error('Data error:', data); // Tambah log untuk debugging
                        upcmElement.textContent = '0%';
                        upcmElement.classList.add('text-red-600');
                    }
                } catch (error) {
                    console.error('Error fetching UPCM points:', error);
                    document.getElementById('upcm-readiness').textContent = '0%';
                }
            };

            // Panggil fungsi fetch
            fetchUPCMPoints();

            // Chart Configuration
            const chartConfig = {
                // Progress Chart
                progressChart: {
                    series: [{
                        name: 'Nilai Rata-rata',
                        data: [65, 75, 82, 78, 85]
                    }],
                    chart: {
                        type: 'line',
                        height: 250,
                        toolbar: { show: false },
                        fontFamily: 'Poppins, sans-serif'
                    },
                    colors: ['#4F46E5'],
                    xaxis: {
                        categories: ['Minggu 1', 'Minggu 2', 'Minggu 3', 'Minggu 4', 'Minggu 5']
                    }
                },

                // Program Match Chart
                programMatch: {
                    series: [{
                        name: '',
                        data: [0,0,0]
                    }],
                    chart: {
                        type: 'bar',
                        height: 250,
                        toolbar: { show: false },
                        fontFamily: 'Poppins, sans-serif'
                    },
                    colors: ['#4F46E5'],
                    plotOptions: {
                        bar: {
                            borderRadius: 4,
                            horizontal: true
                        }
                    },
                    dataLabels: {
                        enabled: true,
                        formatter: (val) => `${val}%`
                    },
                    xaxis: {
                        categories: [
                            
                        ],
                        labels: {
                            formatter: (val) => `${val}%`
                        }
                    }
                }
            };

            // Initialize Charts
            // new ApexCharts(
            //     document.querySelector("#progressChart"), 
            //     chartConfig.progressChart
            // ).render();

            // new ApexCharts(
            //     document.querySelector("#programMatchChart"), 
            //     chartConfig.programMatch
            // ).render();

            // Smooth scroll behavior
            document.querySelectorAll('a[href^="#"]').forEach(anchor => {
                anchor.addEventListener('click', (e) => {
                    e.preventDefault();
                    document.querySelector(anchor.getAttribute('href'))
                        .scrollIntoView({ behavior: 'smooth' });
                });
            });

            // Animation observer
            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        entry.target.classList.add('opacity-100');
                        entry.target.classList.remove('opacity-0');
                    }
                });
            });

            // Apply animations to dashboard cards
            document.querySelectorAll('.card-dashboard').forEach((el) => {
                el.classList.add('opacity-0', 'transition-opacity', 'duration-500');
                observer.observe(el);
            });

            // Add this new fetch call
            const fetchPersonalityType = async () => {
                try {
                    const response = await fetch('php/oauth.php?action=get_personality');
                    if (!response.ok) throw new Error('Network response was not ok');
                    const data = await response.json();
                    
                    // Add debug logs
                    console.log('Personality data received:', data);
                    
                    if (data.status === 'success' && data.personalityType) {
                        console.log('RIASEC code:', data.personalityType);
                        const personalityType = data.personalityType.toUpperCase(); // Ensure uppercase
                        console.log('Available careers for type:', careers[personalityType]);
                        
                        const matchingCareers = careers[personalityType] || [];
                        const careerList = document.getElementById('careerProspectsList');
                        
                        if (careerList) {
                            if (matchingCareers.length > 0) {
                                careerList.innerHTML = '';
                                
                                matchingCareers.forEach(career => {
                                    const careerItem = document.createElement('div');
                                    careerItem.className = 'flex items-center space-x-2 bg-white p-2 rounded-lg shadow-sm hover:bg-gray-50 transition-all';
                                    
                                    let icon = 'briefcase';
                                    if (career.toLowerCase().includes('peneliti')) icon = 'microscope';
                                    if (career.toLowerCase().includes('manajer')) icon = 'tasks';
                                    if (career.toLowerCase().includes('insinyur')) icon = 'cogs';
                                    if (career.toLowerCase().includes('analis')) icon = 'chart-line';
                                    if (career.toLowerCase().includes('developer')) icon = 'code';
                                    if (career.toLowerCase().includes('desainer')) icon = 'pencil-ruler';
                                    if (career.toLowerCase().includes('teknisi')) icon = 'tools';
                                    if (career.toLowerCase().includes('konsultan')) icon = 'comments';
                                    
                                    careerItem.innerHTML = `
                                        <i class="fas fa-${icon} text-blue-600"></i>
                                        <span class="text-sm text-gray-700">${career}</span>
                                    `;
                                    careerList.appendChild(careerItem);
                                });
                            } else {
                                careerList.innerHTML = `
                                    <div class="col-span-2 text-center py-4">
                                        <i class="fas fa-info-circle text-gray-400 text-xl mb-2"></i>
                                        <p class="text-gray-500">Tidak ditemukan karir untuk tipe RIASEC: ${personalityType}</p>
                                    </div>
                                `;
                            }

                            // Update distribution chart
                            const distribution = {
                                R: 0, I: 0, A: 0, S: 0, E: 0, C: 0
                            };

                            distribution[personalityType[0]] = 50;
                            distribution[personalityType[1]] = 30;
                            distribution[personalityType[2]] = 20;

                            console.log('Interest distribution:', distribution);

                            const interestChartConfig = {
                                series: Object.values(distribution),
                                chart: {
                                    type: 'donut',
                                    height: 250
                                },
                                labels: ['Realistis (R)', 'Investigatif (I)', 'Artistik (A)', 'Sosial (S)', 'Enterprising (E)', 'Konvensional (C)'],
                                colors: ['#4F46E5', '#7C3AED', '#06B6D4', '#3B82F6', '#10B981', '#F59E0B']
                            };

                            // Clear and render chart
                            document.querySelector("#interestChart").innerHTML = '';
                            new ApexCharts(
                                document.querySelector("#interestChart"), 
                                interestChartConfig
                            ).render();
                        }
                    } else {
                        console.error('No personality type found in response:', data);
                        document.getElementById('careerProspectsList').innerHTML = `
                            <div class="col-span-2 text-center py-4">
                                <i class="fas fa-exclamation-circle text-gray-400 text-xl mb-2"></i>
                                <p class="text-gray-500">Data RIASEC tidak ditemukan</p>
                                <p class="text-sm text-gray-400">Status: ${data.status}</p>
                            </div>
                        `;
                    }
                } catch (error) {
                    console.error('Error in fetchPersonalityType:', error);
                    document.getElementById('careerProspectsList').innerHTML = `
                        <div class="col-span-2 text-center text-gray-500">
                            <i class="fas fa-exclamation-circle mb-2"></i>
                            <p>Error: ${error.message}</p>
                        </div>
                    `;
                }
            };

            // Initialize charts (without the static interest chart)
            new ApexCharts(
                document.querySelector("#progressChart"), 
                chartConfig.progressChart
            ).render();

            new ApexCharts(
                document.querySelector("#programMatchChart"), 
                chartConfig.programMatch
            ).render();

            // Call the new function along with other initializations
            const updateTotalTests = async () => {
                try {
                    const response = await fetch('php/oauth.php?action=get_points');
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    const data = await response.json();
                    
                    const totalTestsElement = document.getElementById('total-tests');
                    const learningProgressElement = document.getElementById('learning-progress');
                    const profileSection = document.getElementById('profile-section');
                    const skillBarsSection = document.getElementById('skill-bars-section');
                    
                    if (data.status === 'success' && data.points !== null && data.points > 0) {
                        // Show profile and skill sections
                        profileSection.style.display = 'flex';
                        skillBarsSection.style.display = 'block';
                        
                        // Rest of your existing updateTotalTests code...
                        // Update total tests
                        totalTestsElement.textContent = '4';
                        totalTestsElement.classList.remove('text-red-600');
                        totalTestsElement.classList.add('text-green-600');
                        
                        // Calculate and update learning progress
                        const progressPercent = Math.round((4 / 13) * 100);
                        learningProgressElement.textContent = `${progressPercent}%`;
                        
                        // Update learning progress color
                        if (progressPercent >= 30) {
                            learningProgressElement.classList.remove('text-red-600');
                            learningProgressElement.classList.add('text-purple-600');
                        } else {
                            learningProgressElement.classList.remove('text-purple-600');
                            learningProgressElement.classList.add('text-red-600');
                        }
                    } else {
                        // Hide profile and skill sections
                        profileSection.style.display = 'none';
                        skillBarsSection.style.display = 'none';
                        
                        // Rest of your existing error handling...
                        // If points are null or 0, show 0 for both metrics
                        totalTestsElement.textContent = '0';
                        totalTestsElement.classList.remove('text-green-600');
                        totalTestsElement.classList.add('text-red-600');
                        
                        learningProgressElement.textContent = '0%';
                        learningProgressElement.classList.remove('text-purple-600');
                        learningProgressElement.classList.add('text-red-600');
                    }
                } catch (error) {
                    console.error('Error fetching data:', error);
                    // Hide sections on error
                    document.getElementById('profile-section').style.display = 'none';
                    document.getElementById('skill-bars-section').style.display = 'none';
                    document.getElementById('total-tests').textContent = '0';
                    document.getElementById('learning-progress').textContent = '0%';
                }
            };

            // Call all the initialization functions
            // fetchPersonalityType();
            // fetchUPCMPoints();
            // updateTotalTests();
            // updateStudyStats(); // Add this here

            // Move updateStudyStats function here if it's not already at this level
            // const updateStudyStats = async () => {
            //     try {
            //         const response = await fetch('php/oauth.php?action=get_test_scores');
            //         if (!response.ok) throw new Error('Network response was not ok');
            //         const data = await response.json();
                    
            //         if (data.status === 'success') {
            //             const scores = data.scores;
            //             console.log('Received scores:', scores); // Debug log
                        
            //             Object.entries(scores).forEach(([subject, score]) => {
            //                 const scoreElement = document.getElementById(`${subject}-score`);
            //                 const barElement = document.getElementById(`${subject}-bar`);
                            
            //                 if (scoreElement && barElement) {
            //                     console.log(`Updating ${subject} with score ${score}`); // Debug log
            //                     scoreElement.textContent = `${score}%`;
            //                     barElement.style.width = `${score}%`;
            //                 } else {
            //                     console.log(`Elements not found for ${subject}`); // Debug log
            //                 }
            //             });
            //         }
            //     } catch (error) {
            //         console.error('Error fetching test scores:', error);
            //     }
            // };

            // Define the updateStudyStats function before calling it
            const updateStudyStats = async () => {
                try {
                    const response = await fetch('php/oauth.php?action=get_test_scores');
                    const data = await response.json();
                    console.log('Study stats data:', data); // Debug log

                    if (data.status === 'success') {
                        // Map database fields to display IDs
                        const scoreMap = {
                            mtk: { id: 'mtk', label: 'Matematika' },
                            pai: { id: 'pai', label: 'Pendidikan Agama Islam' },
                            inggris: { id: 'inggris', label: 'Bahasa Inggris' },
                            logika: { id: 'logika', label: 'Logika dan Penalaran Analitik' }
                        };

                        Object.entries(data.scores).forEach(([key, score]) => {
                            if (scoreMap[key]) {
                                const scoreElement = document.getElementById(`${scoreMap[key].id}-score`);
                                const barElement = document.getElementById(`${scoreMap[key].id}-bar`);
                                
                                if (scoreElement && barElement) {
                                    scoreElement.textContent = `${score}%`;
                                    barElement.style.width = `${score}%`;

                                    // Add color classes based on score
                                    barElement.classList.remove('bg-red-600', 'bg-yellow-600', 'bg-green-600');
                                    if (score >= 80) {
                                        barElement.classList.add('bg-green-600');
                                    } else if (score >= 60) {
                                        barElement.classList.add('bg-yellow-600');
                                    } else {
                                        barElement.classList.add('bg-red-600');
                                    }
                                }
                            }
                        });
                    }
                } catch (error) {
                    console.error('Error fetching study stats:', error);
                }
            };

            // Call all the initialization functions
            fetchPersonalityType();
            fetchUPCMPoints();
            updateTotalTests();
            updateStudyStats(); // Make sure this is called after defining the function

            // Add this new function to fetch program recommendations
            const fetchProgramRecommendations = async () => {
                try {
                    const response = await fetch('php/oauth.php?action=get_program_recommendations');
                    if (!response.ok) throw new Error('Network response was not ok');
                    const data = await response.json();
                    
                    if (data.status === 'success' && data.recommendations) {
                        // Update the program match chart with the fetched recommendations
                        const programMatchConfig = {
                            series: [{
                                name: 'Kecocokan',
                                data: [92, 85, 65] // These values could be hardcoded or calculated
                            }],
                            chart: {
                                type: 'bar',
                                height: 250,
                                toolbar: { show: false },
                                fontFamily: 'Poppins, sans-serif'
                            },
                            colors: ['#4F46E5'],
                            plotOptions: {
                                bar: {
                                    borderRadius: 4,
                                    horizontal: true
                                }
                            },
                            dataLabels: {
                                enabled: true,
                                formatter: (val) => `${val}%`
                            },
                            xaxis: {
                                categories: [
                                    data.recommendations.rekpro1,
                                    data.recommendations.rekpro2,
                                    data.recommendations.rekpro3
                                ],
                                labels: {
                                    formatter: (val) => `${val}%`
                                }
                            }
                        };

                        // Clear existing chart if any
                        document.querySelector("#programMatchChart").innerHTML = '';
                        
                        // Render new chart
                        new ApexCharts(
                            document.querySelector("#programMatchChart"), 
                            programMatchConfig
                        ).render();

                        // Show the "Mengapa Program Ini?" section
                        document.getElementById('whyProgramSection').style.display = 'block';
                    } else {
                        // Hide the "Mengapa Program Ini?" section if no recommendations
                        document.getElementById('whyProgramSection').style.display = 'none';
                    }
                } catch (error) {
                    console.error('Error fetching program recommendations:', error);
                    // Hide the "Mengapa Program Ini?" section on error
                    document.getElementById('whyProgramSection').style.display = 'none';
                }
            };

            // Call the fetchProgramRecommendations function
            fetchProgramRecommendations();

            // ...rest of existing code...
        });
    </script>
</body>
</html>
